import { Callout } from 'nextra/components'

# @contextualize

In `aspectra`, contexts serve as containers for managing providers. By default,
all providers are stored within the global context (`Context.global`), making
them accessible throughout the application. Providers in the global context can
be injected anywhere using the `@provide` decorator, simplifying dependency
injection for widely-used services.

To restrict a provider to a specific context, use the `@contextualize`
decorator. This enables precise control over where dependencies can be
injected, ensuring that certain providers are only available within designated
parts of your application.

#### Example

Let's see an example where we have two contexts: `DATABASE` and `ORDER`.

```typescript
import { application, contextualize, provide, provider } from 'aspectra'

enum ContextId {
  DATABASE = 'database',
  ORDER = 'order',
}

@contextualize(ContextId.DATABASE)
@provider
class DatabaseProvider {
  public queryAll() {
    return [
      { id: 1, name: 'Laptop', price: 1000 },
      { id: 2, name: 'Smartphone', price: 500 },
    ]
  }
}

@contextualize(ContextId.DATABASE, ContextId.ORDER)
@provider
class OrderProvider {
  @provide(DatabaseProvider)
  private readonly database!: DatabaseProvider

  public process(id: number) {
    const product = this.database
      .queryAll()
      .find(it => it.id === id)
    if (product) {
      console.log(`[id: ${id}] Processing order for ${product.name}`)
    } else {
      console.log(`[id: ${id}] Product not found`)
    }
  }
}

@contextualize(ContextId.ORDER)
@application
class CommerceApplication {
  @provide(OrderProvider)
  private readonly order!: OrderProvider

  public start() {
    this.order.process(1)
    this.order.process(3)
  }
}
```

Let's break down the contexualization:
- `DatabaseProvider` -> `DATABASE`
- `OrderProvider` -> `DATABASE` & `ORDER`
- `CommerceApplication` -> `ORDER`

Here's how we can visualize the context tree:


<Callout>
    By restricting `DatabaseProvider` to the `DATABASE` context, we ensure it
    isn't exposed directly to `CommerceApplication`, and accessible only through
    `OrderProvider`. `Contexts` encapsulate the providers, ensuring secure and
    organized dependency management.
</Callout>
